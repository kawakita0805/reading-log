<!DOCTYPE html>

<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>èª­æ›¸è¨˜éŒ²</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="èª­æ›¸è¨˜éŒ²" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=DM+Serif+Display&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    html, body { background: #1a1208; min-height: 100vh; }
    .app { font-family: 'Noto Serif JP', serif; background: #1a1208; min-height: 100vh; max-width: 430px; margin: 0 auto; color: #f5ead8; }
    .header { padding: 56px 24px 20px; border-bottom: 1px solid rgba(245,234,216,0.12); }
    .header-title { font-family: 'DM Serif Display', serif; font-size: 28px; color: #f5ead8; }
    .header-sub { font-size: 11px; color: #a0906e; margin-top: 4px; letter-spacing: 0.1em; text-transform: uppercase; }
    .content { padding: 20px 20px 100px; }
    .fab { position: fixed; bottom: 32px; right: 24px; width: 58px; height: 58px; border-radius: 50%; background: linear-gradient(135deg, #c9934a, #e8b86d); border: none; color: #1a1208; font-size: 28px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 20px rgba(201,147,74,0.4); cursor: pointer; z-index: 10; }
    .book-card { background: rgba(245,234,216,0.05); border: 1px solid rgba(245,234,216,0.1); border-radius: 12px; padding: 16px 18px; margin-bottom: 12px; cursor: pointer; }
    .book-title { font-size: 16px; font-weight: 700; color: #f5ead8; line-height: 1.4; }
    .book-author { font-size: 12px; color: #a0906e; margin-top: 3px; }
    .progress-bar-bg { height: 4px; background: rgba(245,234,216,0.1); border-radius: 2px; margin-top: 12px; }
    .progress-bar-fill { height: 4px; background: linear-gradient(90deg, #c9934a, #e8b86d); border-radius: 2px; }
    .progress-label { font-size: 11px; color: #a0906e; margin-top: 6px; display: flex; justify-content: space-between; }
    .back-btn { display: flex; align-items: center; gap: 6px; background: none; border: none; color: #c9934a; font-size: 14px; font-family: 'Noto Serif JP', serif; cursor: pointer; padding: 0; margin-bottom: 20px; }
    .section-title { font-size: 11px; letter-spacing: 0.15em; text-transform: uppercase; color: #a0906e; margin: 24px 0 12px; }
    .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .stat-box { background: rgba(245,234,216,0.05); border: 1px solid rgba(245,234,216,0.1); border-radius: 10px; padding: 14px; }
    .stat-val { font-family: 'DM Serif Display', serif; font-size: 20px; color: #e8b86d; }
    .stat-key { font-size: 11px; color: #a0906e; margin-top: 4px; }
    .session-item { border-left: 2px solid rgba(201,147,74,0.4); padding: 10px 14px; margin-bottom: 10px; }
    .session-date { font-size: 11px; color: #a0906e; }
    .session-stats { font-size: 14px; color: #f5ead8; margin-top: 3px; }
    .session-note { font-size: 12px; color: #a0906e; margin-top: 4px; }
    .action-btn { width: 100%; padding: 14px; border-radius: 10px; border: none; cursor: pointer; font-family: 'Noto Serif JP', serif; font-size: 15px; font-weight: 700; margin-bottom: 10px; }
    .btn-primary { background: linear-gradient(135deg, #c9934a, #e8b86d); color: #1a1208; }
    .btn-secondary { background: rgba(245,234,216,0.08); color: #f5ead8; border: 1px solid rgba(245,234,216,0.15); }
    .btn-danger { background: rgba(220,60,60,0.15); color: #e86d6d; border: 1px solid rgba(220,60,60,0.2); }
    .field { margin-bottom: 16px; }
    .field label { font-size: 12px; color: #a0906e; display: block; margin-bottom: 6px; }
    .input { width: 100%; background: rgba(245,234,216,0.06); border: 1px solid rgba(245,234,216,0.15); border-radius: 10px; padding: 13px 14px; color: #f5ead8; font-family: 'Noto Serif JP', serif; font-size: 15px; outline: none; }
    .input:focus { border-color: #c9934a; }
    .input::placeholder { color: #6b5c40; }
    .timer-display { text-align: center; padding: 28px 0; }
    .timer-num { font-family: 'DM Serif Display', serif; font-size: 56px; color: #e8b86d; line-height: 1; }
    .timer-sub { font-size: 12px; color: #a0906e; margin-top: 8px; letter-spacing: 0.1em; }
    .timer-btns { display: flex; gap: 10px; margin-bottom: 24px; }
    .timer-btns .action-btn { flex: 1; }
    .empty { text-align: center; padding: 60px 0; color: #6b5c40; font-size: 14px; line-height: 1.8; }
    .empty-icon { font-size: 48px; margin-bottom: 16px; }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 20px; font-size: 11px; margin-left: 8px; }
    .badge-done { background: rgba(100,200,120,0.15); color: #7dd87d; border: 1px solid rgba(100,200,120,0.25); }
    .badge-reading { background: rgba(201,147,74,0.15); color: #e8b86d; border: 1px solid rgba(201,147,74,0.25); }
    .row { display: flex; justify-content: space-between; align-items: flex-start; }
  </style>
</head>
<body>
<div class="app" id="app"></div>
<script>
const STORAGE_KEY = 'reading-log-v1';
function loadBooks() { try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; } catch { return []; } }
function saveBooks(b) { localStorage.setItem(STORAGE_KEY, JSON.stringify(b)); }
function formatTime(s) {
  const h = Math.floor(s/3600), m = Math.floor((s%3600)/60), sec = s%60;
  if (h > 0) return h+'æ™‚é–“'+m+'åˆ†';
  if (m > 0) return m+'åˆ†'+sec+'ç§’';
  return sec+'ç§’';
}
function formatDate(d) {
  if (!d) return 'â€”';
  return new Date(d).toLocaleDateString('ja-JP', {year:'numeric',month:'short',day:'numeric'});
}
function today() { return new Date().toISOString().split('T')[0]; }
function getStats(book) {
  const totalReadTime = book.sessions.reduce((s,x)=>s+x.duration,0);
  const readPages = book.sessions.reduce((s,x)=>s+x.pages,0);
  const progress = book.totalPages > 0 ? Math.min(readPages/book.totalPages*100,100) : 0;
  return {totalReadTime, readPages, progress};
}

let books = loadBooks();
let timerVal = 0, timerRunning = false, timerInterval = null;
let currentBookId = null;

function renderList() {
const empty = books.length === 0 ? `<div class="empty"><div class="empty-icon">ğŸ“š</div><div>ã¾ã æœ¬ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“<br>å³ä¸‹ã®ï¼‹ãƒœã‚¿ãƒ³ã‹ã‚‰è¿½åŠ ã—ã¾ã—ã‚‡ã†</div></div>` : â€˜â€™;
const cards = books.map(b => {
const {readPages, progress} = getStats(b);
const done = b.endDate || readPages >= b.totalPages;
return `<div class="book-card" onclick="showDetail('${b.id}')"> <div class="row"><div class="book-title" style="flex:1">${b.title}</div><span class="badge ${done?'badge-done':'badge-reading'}">${done?'èª­äº†':'èª­ä¸­'}</span></div> ${b.author ? `<div class="book-author">${b.author}</div>` : ''} <div class="progress-bar-bg"><div class="progress-bar-fill" style="width:${progress}%"></div></div> <div class="progress-label"><span>${readPages} / ${b.totalPages} ãƒšãƒ¼ã‚¸</span><span>${Math.round(progress)}%</span></div> </div>`;
}).join(â€™â€™);
document.getElementById(â€˜appâ€™).innerHTML = ` <div class="header"><div class="header-sub">My Library</div><div class="header-title">èª­æ›¸è¨˜éŒ²</div></div> <div class="content">${empty}${cards}</div> <button class="fab" onclick="renderAdd()">ï¼‹</button>`;
}

function renderAdd() {
document.getElementById(â€˜appâ€™).innerHTML = ` <div class="header"><div class="header-title">æ–°ã—ã„æœ¬ã‚’ç™»éŒ²</div></div> <div class="content"> <button class="back-btn" onclick="renderList()">â† æˆ»ã‚‹</button> <div class="field"><label>ã‚¿ã‚¤ãƒˆãƒ« *</label><input class="input" id="f-title" placeholder="æœ¬ã®ã‚¿ã‚¤ãƒˆãƒ«"></div> <div class="field"><label>è‘—è€…</label><input class="input" id="f-author" placeholder="è‘—è€…å"></div> <div class="field"><label>ç·ãƒšãƒ¼ã‚¸æ•° *</label><input class="input" id="f-pages" type="number" placeholder="ä¾‹ï¼š320"></div> <button class="action-btn btn-primary" onclick="addBook()">ç™»éŒ²ã™ã‚‹</button> </div>`;
}

function addBook() {
const title = document.getElementById(â€˜f-titleâ€™).value.trim();
const author = document.getElementById(â€˜f-authorâ€™).value.trim();
const totalPages = parseInt(document.getElementById(â€˜f-pagesâ€™).value);
if (!title || !totalPages) { alert(â€˜ã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒšãƒ¼ã‚¸æ•°ã¯å¿…é ˆã§ã™â€™); return; }
books.unshift({id: Date.now().toString(), title, author, totalPages, startDate: today(), endDate: null, sessions: []});
saveBooks(books);
renderList();
}

function showDetail(id) { currentBookId = id; renderDetail(); }

function renderDetail() {
const book = books.find(b => b.id === currentBookId);
if (!book) return renderList();
const {totalReadTime, readPages, progress} = getStats(book);
const sessions = [â€¦book.sessions].reverse().map(s => `<div class="session-item"> <div class="session-date">${formatDate(s.date)}</div> <div class="session-stats">${s.pages}ãƒšãƒ¼ã‚¸èª­äº†ãƒ»${formatTime(s.duration)}</div> ${s.notes ?`<div class="session-note">${s.notes}</div>` : ''} </div>`).join(â€™â€™);
document.getElementById(â€˜appâ€™).innerHTML = `<div class="header"> <button class="back-btn" onclick="renderList()">â† ä¸€è¦§ã¸</button> <div class="header-sub">${book.author || 'è‘—è€…ä¸æ˜'}</div> <div class="header-title" style="font-size:20px">${book.title}</div> </div> <div class="content"> <div class="progress-bar-bg" style="height:6px"><div class="progress-bar-fill" style="width:${progress}%;height:6px"></div></div> <div class="progress-label"><span>${readPages} / ${book.totalPages} ãƒšãƒ¼ã‚¸</span><span>${Math.round(progress)}%</span></div> <div class="section-title">çµ±è¨ˆ</div> <div class="stat-grid"> <div class="stat-box"><div class="stat-val">${formatTime(totalReadTime)}</div><div class="stat-key">ç·èª­æ›¸æ™‚é–“</div></div> <div class="stat-box"><div class="stat-val">${book.sessions.length}</div><div class="stat-key">èª­æ›¸å›æ•°</div></div> <div class="stat-box"><div class="stat-val">${formatDate(book.startDate)}</div><div class="stat-key">èª­æ›¸é–‹å§‹æ—¥</div></div> <div class="stat-box"><div class="stat-val">${formatDate(book.endDate)}</div><div class="stat-key">èª­æ›¸çµ‚äº†æ—¥</div></div> </div> <div style="margin-top:20px"> <button class="action-btn btn-primary" onclick="showSession()">ğŸ“– èª­æ›¸ã‚’è¨˜éŒ²ã™ã‚‹</button> </div> ${sessions ?`<div class="section-title">èª­æ›¸å±¥æ­´</div>${sessions}` : ''} <button class="action-btn btn-danger" onclick="deleteBook('${book.id}')">ã“ã®æœ¬ã‚’å‰Šé™¤</button> </div>`;
}

function deleteBook(id) {
if (!confirm(â€˜ã“ã®æœ¬ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿâ€™)) return;
books = books.filter(b => b.id !== id);
saveBooks(books);
renderList();
}

function showSession() {
timerVal = 0; timerRunning = false;
if (timerInterval) clearInterval(timerInterval);
renderSession();
}

function renderSession() {
const book = books.find(b => b.id === currentBookId);
document.getElementById(â€˜appâ€™).innerHTML = ` <div class="header"> <div class="header-sub">Reading Session</div> <div class="header-title" style="font-size:18px;margin-top:4px">${book.title}</div> </div> <div class="content"> <button class="back-btn" onclick="cancelSession()">â† ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button> <div class="timer-display"> <div class="timer-num" id="timer-display">00:00:00</div> <div class="timer-sub">èª­æ›¸ã‚¿ã‚¤ãƒãƒ¼</div> </div> <div class="timer-btns"> <button class="action-btn btn-secondary" id="timer-btn" onclick="toggleTimer()">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button> <button class="action-btn btn-secondary" onclick="resetTimer()">ãƒªã‚»ãƒƒãƒˆ</button> </div> <div class="field"><label>ä»Šå›èª­ã‚“ã ãƒšãƒ¼ã‚¸æ•°</label><input class="input" id="s-pages" type="number" placeholder="ä¾‹ï¼š30"></div> <div class="field"><label>ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label><input class="input" id="s-notes" placeholder="æ„Ÿæƒ³ã‚„æ°—ã¥ããªã©"></div> <button class="action-btn btn-primary" onclick="saveSession()">è¨˜éŒ²ã‚’ä¿å­˜</button> </div>`;
}

function toggleTimer() {
timerRunning = !timerRunning;
if (timerRunning) {
timerInterval = setInterval(() => {
timerVal++;
const h = String(Math.floor(timerVal/3600)).padStart(2,â€˜0â€™);
const m = String(Math.floor((timerVal%3600)/60)).padStart(2,â€˜0â€™);
const s = String(timerVal%60).padStart(2,â€˜0â€™);
const el = document.getElementById(â€˜timer-displayâ€™);
const btn = document.getElementById(â€˜timer-btnâ€™);
if (el) el.textContent = `${h}:${m}:${s}`;
if (btn) btn.textContent = â€˜â¸ ä¸€æ™‚åœæ­¢â€™;
}, 1000);
} else {
clearInterval(timerInterval);
const btn = document.getElementById(â€˜timer-btnâ€™);
if (btn) btn.textContent = â€˜â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆâ€™;
}
}

function resetTimer() {
timerRunning = false; clearInterval(timerInterval); timerVal = 0;
const el = document.getElementById(â€˜timer-displayâ€™);
const btn = document.getElementById(â€˜timer-btnâ€™);
if (el) el.textContent = â€˜00:00:00â€™;
if (btn) btn.textContent = â€˜â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆâ€™;
}

function cancelSession() {
timerRunning = false; clearInterval(timerInterval); timerVal = 0;
renderDetail();
}

function saveSession() {
const pages = parseInt(document.getElementById(â€˜s-pagesâ€™).value) || 0;
const notes = document.getElementById(â€˜s-notesâ€™).value;
timerRunning = false; clearInterval(timerInterval);
const idx = books.findIndex(b => b.id === currentBookId);
if (idx === -1) return;
books[idx].sessions.push({date: today(), duration: timerVal, pages, notes});
const readPages = books[idx].sessions.reduce((s,x)=>s+x.pages,0);
if (readPages >= books[idx].totalPages && !books[idx].endDate) books[idx].endDate = today();
saveBooks(books);
timerVal = 0;
renderDetail();
}

renderList();
</script>

</body>
</html>
