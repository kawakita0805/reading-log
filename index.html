<!DOCTYPE html>

<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>èª­æ›¸è¨˜éŒ²</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="èª­æ›¸è¨˜éŒ²">
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{background:#1a1208;min-height:100vh}
body{font-family:"Noto Serif JP",serif;color:#f5ead8}
#app{max-width:430px;margin:0 auto;min-height:100vh;background:#1a1208}
.hd{padding:56px 24px 20px;border-bottom:1px solid rgba(245,234,216,.12)}
.hd-t{font-family:"DM Serif Display",serif;font-size:28px;color:#f5ead8}
.hd-s{font-size:11px;color:#a0906e;margin-top:4px;letter-spacing:.1em;text-transform:uppercase}
.ct{padding:20px 20px 100px}
.fab{position:fixed;bottom:32px;right:24px;width:58px;height:58px;border-radius:50%;background:linear-gradient(135deg,#c9934a,#e8b86d);border:none;color:#1a1208;font-size:28px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 20px rgba(201,147,74,.4);cursor:pointer;z-index:10}
.card{background:rgba(245,234,216,.05);border:1px solid rgba(245,234,216,.1);border-radius:12px;padding:16px 18px;margin-bottom:12px;cursor:pointer}
.ct1{font-size:16px;font-weight:700;color:#f5ead8;line-height:1.4}
.ct2{font-size:12px;color:#a0906e;margin-top:3px}
.pb{height:4px;background:rgba(245,234,216,.1);border-radius:2px;margin-top:12px}
.pf{height:4px;background:linear-gradient(90deg,#c9934a,#e8b86d);border-radius:2px}
.pl{font-size:11px;color:#a0906e;margin-top:6px;display:flex;justify-content:space-between}
.bk{background:none;border:none;color:#c9934a;font-size:14px;font-family:"Noto Serif JP",serif;cursor:pointer;padding:0;margin-bottom:20px}
.st{font-size:11px;letter-spacing:.15em;text-transform:uppercase;color:#a0906e;margin:24px 0 12px}
.sg{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.sb{background:rgba(245,234,216,.05);border:1px solid rgba(245,234,216,.1);border-radius:10px;padding:14px}
.sv{font-family:"DM Serif Display",serif;font-size:20px;color:#e8b86d}
.sk{font-size:11px;color:#a0906e;margin-top:4px}
.si{border-left:2px solid rgba(201,147,74,.4);padding:10px 14px;margin-bottom:10px}
.sd{font-size:11px;color:#a0906e}
.ss{font-size:14px;color:#f5ead8;margin-top:3px}
.sn{font-size:12px;color:#a0906e;margin-top:4px}
.btn{width:100%;padding:14px;border-radius:10px;border:none;cursor:pointer;font-family:"Noto Serif JP",serif;font-size:15px;font-weight:700;margin-bottom:10px}
.bp{background:linear-gradient(135deg,#c9934a,#e8b86d);color:#1a1208}
.bs{background:rgba(245,234,216,.08);color:#f5ead8;border:1px solid rgba(245,234,216,.15)}
.bd{background:rgba(220,60,60,.15);color:#e86d6d;border:1px solid rgba(220,60,60,.2)}
.fl{margin-bottom:16px}
.fl label{font-size:12px;color:#a0906e;display:block;margin-bottom:6px}
.inp{width:100%;background:rgba(245,234,216,.06);border:1px solid rgba(245,234,216,.15);border-radius:10px;padding:13px 14px;color:#f5ead8;font-family:"Noto Serif JP",serif;font-size:15px;outline:none}
.inp:focus{border-color:#c9934a}
.td{text-align:center;padding:28px 0}
.tn{font-family:"DM Serif Display",serif;font-size:56px;color:#e8b86d;line-height:1}
.ts{font-size:12px;color:#a0906e;margin-top:8px;letter-spacing:.1em}
.tb{display:flex;gap:10px;margin-bottom:24px}
.tb .btn{flex:1}
.em{text-align:center;padding:60px 0;color:#6b5c40;font-size:14px;line-height:1.8}
.ei{font-size:48px;margin-bottom:16px}
.bg{display:inline-block;padding:2px 8px;border-radius:20px;font-size:11px;margin-left:8px}
.bd2{background:rgba(100,200,120,.15);color:#7dd87d;border:1px solid rgba(100,200,120,.25)}
.br{background:rgba(201,147,74,.15);color:#e8b86d;border:1px solid rgba(201,147,74,.25)}
.rw{display:flex;justify-content:space-between;align-items:flex-start}
</style>
</head>
<body>
<div id="app"></div>
<script>
var SK="rl1";
function load(){try{return JSON.parse(localStorage.getItem(SK))||[];}catch(e){return[];}}
function save(b){localStorage.setItem(SK,JSON.stringify(b));}
function ft(s){
  var h=Math.floor(s/3600),m=Math.floor((s%3600)/60),sec=s%60;
  if(h>0)return h+"æ™‚é–“"+m+"åˆ†";
  if(m>0)return m+"åˆ†"+sec+"ç§’";
  return sec+"ç§’";
}
function fd(d){
  if(!d)return "â€”";
  return new Date(d).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric"});
}
function td(){return new Date().toISOString().split("T")[0];}
function gs(book){
  var t=0,p=0,i;
  for(i=0;i<book.sessions.length;i++){t+=book.sessions[i].duration;p+=book.sessions[i].pages;}
  var pr=book.totalPages>0?Math.min(p/book.totalPages*100,100):0;
  return {totalReadTime:t,readPages:p,progress:pr};
}

var books=load();
var tv=0,tr=false,ti=null,cid=null;

function set(html){document.getElementById(â€œappâ€).innerHTML=html;}

function renderList(){
var html=â€<div class='hd'><div class='hd-s'>My Library</div><div class='hd-t'>èª­æ›¸è¨˜éŒ²</div></div><div class='ct'>â€;
if(books.length===0){
html+=â€<div class='em'><div class='ei'>ğŸ“š</div><div>ã¾ã æœ¬ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“<br>å³ä¸‹ã®ï¼‹ãƒœã‚¿ãƒ³ã‹ã‚‰è¿½åŠ ã—ã¾ã—ã‚‡ã†</div></div>â€;
} else {
var i,b,s,done;
for(i=0;i<books.length;i++){
b=books[i];s=gs(b);done=b.endDate||(s.readPages>=b.totalPages);
html+=â€<div class='card' onclick='detail(\""+b.id+"\")'>â€;
html+=â€<div class='rw'><div class='ct1' style='flex:1'>â€+b.title+â€</div>â€;
html+=â€<span class='bg "+(done?"bd2":"br")+"'>â€+(done?â€œèª­äº†â€:â€œèª­ä¸­â€)+â€</span></div>â€;
if(b.author)html+=â€<div class='ct2'>â€+b.author+â€</div>â€;
html+=â€<div class='pb'><div class='pf' style='width:"+s.progress+"%'></div></div>â€;
html+=â€<div class='pl'><span>â€+s.readPages+â€ / â€œ+b.totalPages+â€ ãƒšãƒ¼ã‚¸</span><span>â€+Math.round(s.progress)+â€%</span></div>â€;
html+=â€</div>â€;
}
}
html+=â€</div><button class='fab' onclick='renderAdd()'>ï¼‹</button>â€;
set(html);
}

function renderAdd(){
set(â€<div class='hd'><div class='hd-t'>æ–°ã—ã„æœ¬ã‚’ç™»éŒ²</div></div><div class='ct'><button class='bk' onclick='renderList()'>â† æˆ»ã‚‹</button><div class='fl'><label>ã‚¿ã‚¤ãƒˆãƒ« *</label><input class='inp' id='ft' placeholder='æœ¬ã®ã‚¿ã‚¤ãƒˆãƒ«'></div><div class='fl'><label>è‘—è€…</label><input class='inp' id='fa' placeholder='è‘—è€…å'></div><div class='fl'><label>ç·ãƒšãƒ¼ã‚¸æ•° *</label><input class='inp' id='fp' type='number' placeholder='ä¾‹ï¼š320'></div><button class='btn bp' onclick='addBook()'>ç™»éŒ²ã™ã‚‹</button></div>â€);
}

function addBook(){
var t=document.getElementById(â€œftâ€).value.trim();
var a=document.getElementById(â€œfaâ€).value.trim();
var p=parseInt(document.getElementById(â€œfpâ€).value);
if(!t||!p){alert(â€œã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒšãƒ¼ã‚¸æ•°ã¯å¿…é ˆã§ã™â€);return;}
books.unshift({id:Date.now()+â€â€,title:t,author:a,totalPages:p,startDate:td(),endDate:null,sessions:[]});
save(books);renderList();
}

function detail(id){cid=id;renderDetail();}

function renderDetail(){
var book=null,i;
for(i=0;i<books.length;i++){if(books[i].id===cid){book=books[i];break;}}
if(!book){renderList();return;}
var s=gs(book);
var html=â€<div class='hd'><button class='bk' onclick='renderList()'>â† ä¸€è¦§ã¸</button>â€;
html+=â€<div class='hd-s'>â€+(book.author||â€œè‘—è€…ä¸æ˜â€)+â€</div>â€;
html+=â€<div class='hd-t' style='font-size:20px'>â€+book.title+â€</div></div><div class='ct'>â€;
html+=â€<div class='pb' style='height:6px'><div class='pf' style='width:"+s.progress+"%;height:6px'></div></div>â€;
html+=â€<div class='pl'><span>â€+s.readPages+â€ / â€œ+book.totalPages+â€ ãƒšãƒ¼ã‚¸</span><span>â€+Math.round(s.progress)+â€%</span></div>â€;
html+=â€<div class='st'>çµ±è¨ˆ</div><div class='sg'>â€;
html+=â€<div class='sb'><div class='sv'>â€+ft(s.totalReadTime)+â€</div><div class='sk'>ç·èª­æ›¸æ™‚é–“</div></div>â€;
html+=â€<div class='sb'><div class='sv'>â€+book.sessions.length+â€</div><div class='sk'>èª­æ›¸å›æ•°</div></div>â€;
html+=â€<div class='sb'><div class='sv'>â€+fd(book.startDate)+â€</div><div class='sk'>èª­æ›¸é–‹å§‹æ—¥</div></div>â€;
html+=â€<div class='sb'><div class='sv'>â€+fd(book.endDate)+â€</div><div class='sk'>èª­æ›¸çµ‚äº†æ—¥</div></div>â€;
html+=â€</div><div style='margin-top:20px'><button class='btn bp' onclick='showSess()'>ğŸ“– èª­æ›¸ã‚’è¨˜éŒ²ã™ã‚‹</button></div>â€;
var sess=[].concat(book.sessions).reverse();
if(sess.length>0){
html+=â€<div class='st'>èª­æ›¸å±¥æ­´</div>â€;
for(i=0;i<sess.length;i++){
html+=â€<div class='si'><div class='sd'>â€+fd(sess[i].date)+â€</div>â€;
html+=â€<div class='ss'>â€+sess[i].pages+â€œãƒšãƒ¼ã‚¸èª­äº†ãƒ»â€+ft(sess[i].duration)+â€</div>â€;
if(sess[i].notes)html+=â€<div class='sn'>â€+sess[i].notes+â€</div>â€;
html+=â€</div>â€;
}
}
html+=â€<button class='btn bd' onclick='delBook(\""+book.id+"\")'>ã“ã®æœ¬ã‚’å‰Šé™¤</button></div>â€;
set(html);
}

function delBook(id){
if(!confirm(â€œã“ã®æœ¬ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿâ€))return;
var nb=[];for(var i=0;i<books.length;i++){if(books[i].id!==id)nb.push(books[i]);}
books=nb;save(books);renderList();
}

function showSess(){tv=0;tr=false;if(ti)clearInterval(ti);renderSess();}

function renderSess(){
var book=null,i;
for(i=0;i<books.length;i++){if(books[i].id===cid){book=books[i];break;}}
set(â€<div class='hd'><div class='hd-s'>Reading Session</div><div class='hd-t' style='font-size:18px;margin-top:4px'>â€+book.title+â€</div></div><div class='ct'><button class='bk' onclick='cancelSess()'>â† ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button><div class='td'><div class='tn' id='td'>00:00:00</div><div class='ts'>èª­æ›¸ã‚¿ã‚¤ãƒãƒ¼</div></div><div class='tb'><button class='btn bs' id='tbtn' onclick='togTimer()'>â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button><button class='btn bs' onclick='rstTimer()'>ãƒªã‚»ãƒƒãƒˆ</button></div><div class='fl'><label>ä»Šå›èª­ã‚“ã ãƒšãƒ¼ã‚¸æ•°</label><input class='inp' id='sp' type='number' placeholder='ä¾‹ï¼š30'></div><div class='fl'><label>ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label><input class='inp' id='sn' placeholder='æ„Ÿæƒ³ã‚„æ°—ã¥ããªã©'></div><button class='btn bp' onclick='saveSess()'>è¨˜éŒ²ã‚’ä¿å­˜</button></div>â€);
}

function pad(n){return n<10?â€œ0â€+n:â€â€+n;}

function togTimer(){
tr=!tr;
if(tr){
ti=setInterval(function(){
tv++;
var h=Math.floor(tv/3600),m=Math.floor((tv%3600)/60),s=tv%60;
var el=document.getElementById(â€œtdâ€),btn=document.getElementById(â€œtbtnâ€);
if(el)el.textContent=pad(h)+â€:â€+pad(m)+â€:â€+pad(s);
if(btn)btn.textContent=â€œâ¸ ä¸€æ™‚åœæ­¢â€;
},1000);
} else {
clearInterval(ti);
var btn=document.getElementById(â€œtbtnâ€);
if(btn)btn.textContent=â€œâ–¶ ã‚¹ã‚¿ãƒ¼ãƒˆâ€;
}
}

function rstTimer(){
tr=false;clearInterval(ti);tv=0;
var el=document.getElementById(â€œtdâ€),btn=document.getElementById(â€œtbtnâ€);
if(el)el.textContent=â€œ00:00:00â€;
if(btn)btn.textContent=â€œâ–¶ ã‚¹ã‚¿ãƒ¼ãƒˆâ€;
}

function cancelSess(){tr=false;clearInterval(ti);tv=0;renderDetail();}

function saveSess(){
var p=parseInt(document.getElementById(â€œspâ€).value)||0;
var n=document.getElementById(â€œsnâ€).value;
tr=false;clearInterval(ti);
var i,idx=-1;
for(i=0;i<books.length;i++){if(books[i].id===cid){idx=i;break;}}
if(idx===-1)return;
books[idx].sessions.push({date:td(),duration:tv,pages:p,notes:n});
var rp=0;for(i=0;i<books[idx].sessions.length;i++)rp+=books[idx].sessions[i].pages;
if(rp>=books[idx].totalPages&&!books[idx].endDate)books[idx].endDate=td();
save(books);tv=0;renderDetail();
}

renderList();
</script>

</body>
</html>
